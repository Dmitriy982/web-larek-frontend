# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Об архитектуре 

Реализация процессов в приложении включает в себя использование событий для координации взаимодействия между различными частями приложения, а также использование промисов для управления асинхронными операциями и их последовательностью.

Архитектура проекта организована следующим образом:

Компоненты:
Компоненты представляют отдельные части пользовательского интерфейса и обеспечивают их функциональность.

Модели:
Модели отвечают за хранение и управление данными приложения.

Сервисы или API:
Сервисы или API обеспечивают взаимодействие с сервером или внешними источниками данных.

Обработка событий:
События используются для связи между различными компонентами или частями приложения, например, для обновления интерфейса в ответ на действия пользователя.

Отображение данных:
Отображение данных обычно выполняется компонентами, которые отображают информацию пользователю.

Управление состоянием:
Механизмы управления состоянием приложения.

## Базовые классы
### Класс AppState
Данный класс представляет состояние приложения, управляя различными аспектами, такими как корзина пользователя, каталог товаров, статус загрузки, детали заказа и ошибки формы.
Свойства:

basket: Массив строк, представляющих товары в корзине пользователя.
catalog: Массив строк ProductItem, представляющих каталог доступных товаров.
order: Объект, содержащий детали заказа, такие как электронная почта, телефон и товары.
formErrors: Объект, содержащий ошибки валидации формы.
Методы:

clearBasket(): Очищает корзину пользователя и сбрасывает информацию о ставках для товаров.
getTotal(): Рассчитывает общую стоимость товаров в заказе.
setCatalog(): Устанавливает каталог товаров и генерирует событие изменений.
validateOrder(): Проверяет поля заказа на валидность и генерирует ошибки формы.
addItemToBasket(item: BasketItem): Добавление товара в корзину.
deleteItem(id: string): Удаление товара из корзины.
checkItemInBasket(id: string): Проверка наличия товара в корзине.
getTotal(): Расчет общей стоимости товаров.
setOrderField(field: keyof IOrderForm, value: string): Добавление данных заказа


### Класс Card<T>

Представляет общее вью карточки, которая может содержать заголовок, изображение, описание и кнопку действия. Используется для создания множества форм.

Класс является дженериком и принимает в переменной  T  тип данных.

Свойства:

_title: Элемент заголовка карточки.
_image: Элемент изображения карточки (необязательно).
_description: Элемент описания карточки (необязательно).
_button: Элемент кнопки действия карточки (необязательно).
Конструктор:

constructor(blockName: string, container: HTMLElement, actions?: ICardActions): Создает новый экземпляр карточки сущности.
blockName: Название CSS класса блока, используемого для стилизации карточки.
container: Родительский элемент, в который будет добавлена карточка.
actions: Объект с действиями, которые можно выполнить при нажатии на карточку.

Методы:
set id(value: string): Устанавливает идентификатор для карточки.
get id(): string: Получает идентификатор карточки.
set title(value: string): Устанавливает заголовок для карточки.
set image(value: string): Устанавливает изображение для карточки.
set description(): Устанавливает описание для карточки. Может быть строкой или массивом строк.
set price(value: string): Выставление цены.
set buttonToggle (value:boolean): Скрытие кнопки
set category(value: string): Выставление категории.


### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы on ,  off ,  emit  — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы  onAll и  offAll  — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод  trigger , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса  EventEmitter.

### Класс API
Родительский класс для API, имеет основные методы get и post для работы с API

### Класс abstract Model<T>
Этот класс представляет абстрактную модель (Model), которая служит основой для создания конкретных моделей данных. 

Конструктор:
Принимает два параметра:
data: Частичные данные (Partial<T>) для инициализации модели. Эти данные могут содержать только часть свойств, определенных в типе T.
events: Объект событий (IEvents), который используется для управления событиями модели.
Внутри конструктора используется Object.assign, чтобы скопировать свойства из объекта data в текущий экземпляр модели.
Метод emitChanges:
Этот метод используется для сообщения всем заинтересованным сторонам о том, что модель была изменена.
Принимает два параметра:
event: Название события, которое нужно передать.
payload (необязательный): Дополнительные данные, которые могут быть переданы вместе с событием.
Внутри метода используется this.events.emit для передачи события с указанным именем и данными. Если payload не передан, используется пустой объект {}.

### Класс Component<T>

Этот класс Component<T> представляет абстрактный компонент, который обеспечивает инструментарий для работы с DOM (Document Object Model) в дочерних компонентах.

Конструктор:
Принимает один параметр container, который представляет собой корневой элемент (HTMLElement), в который будет встроен компонент.
Помечен как protected readonly, что означает, что после инициализации значение этого свойства не может быть изменено извне класса.
Метод toggleClass:
Переключает класс указанного элемента DOM.
Принимает три параметра: element (HTMLElement), className (строка) - имя класса для переключения, force (необязательный параметр, логическое значение) - указывает, следует ли добавить или удалить класс.
Метод setText:
Устанавливает текстовое содержимое для указанного элемента DOM.
Принимает два параметра: element (HTMLElement) и value (любой тип данных), который будет преобразован в строку и установлен как текстовое содержимое элемента.
Метод setDisabled:
Устанавливает или снимает блокировку для указанного элемента DOM.
Принимает два параметра: element (HTMLElement) и state (логическое значение), указывающее, следует ли установить блокировку (true) или снять ее (false).
Методы setHidden и setVisible:
Скрытие и отображение элемента DOM соответственно, изменяя значение CSS-свойства display.
Они принимают один параметр: element (HTMLElement), который нужно скрыть или отобразить.
Метод setImage:
Устанавливает изображение для указанного элемента img DOM.
Принимает три параметра: element (HTMLImageElement), src (строка) - URL изображения, и необязательный параметр alt (строка) - альтернативный текст для изображения.
Метод render:
Метод для отображения компонента в DOM.
Принимает необязательный параметр data, который представляет частичные данные (Partial<T>), которые могут быть применены к компоненту.
Применяет переданные данные к текущему экземпляру компонента с помощью Object.assign.
Возвращает корневой элемент компонента.
Этот класс предоставляет основные методы для работы с DOM в компонентах, такие как установка текста, управление классами, блокировка элементов, отображение и скрытие элементов, установка изображений и рендеринг компонента. Он может быть использован в качестве базового класса для создания конкретных компонентов, добавляя дополнительные методы и свойства, специфичные для конкретных компонентов.

### Класс Form

Этот класс Form представляет собой форму в веб-приложении и наследует функциональность от базового класса Component<IFormState>.

Конструктор:
Принимает два параметра:

container: корневой элемент (HTMLFormElement), в который будет встроена форма.
events: объект событий (IEvents), используемый для управления событиями формы.
Конструктор выполняет следующие действия:

Вызывает конструктор родительского класса Component<IFormState> с переданным корневым элементом.
Использует функцию ensureElement для получения ссылок на кнопку отправки формы (_submit) и элемент отображения ошибок (_errors).
Добавляет обработчик события ввода (input) для отслеживания изменений в полях формы. При изменении значения поля вызывает метод onInputChange с именем и значением измененного поля.
Добавляет обработчик события отправки формы (submit), который предотвращает стандартное поведение формы и вызывает событие отправки формы с именем формы.
Методы:
onInputChange(field: keyof T, value: string): Вызывает событие изменения значения поля формы, передавая имя поля и новое значение.
render(state: Partial<T> & IFormState): Метод для обновления состояния формы. Разбивает переданное состояние на валидность (valid), ошибки (errors) и остальные поля формы, и обновляет соответствующие элементы DOM.

Сеттеры:
valid: Устанавливает доступность кнопки отправки формы в зависимости от валидности формы. Если форма валидна, кнопка доступна, иначе - нет.
errors: Устанавливает текстовое содержимое элемента отображения ошибок (_errors), показывая сообщения об ошибках.
Этот класс Form предоставляет методы для управления элементами формы, такими как отслеживание изменений в полях формы, отображение ошибок и управление состоянием кнопки отправки. Он использует наследование от базового класса Component<IFormState> для переиспользования общих методов для работы с DOM и добавляет специфичную для формы логику.

## Компоненты 

### Класс LarekAPI 
Этот класс определяет абстракцию для взаимодействия с API, предоставляя методы для получения информации о карточках.

Свойства:
readonly cdn: string; свойство cdn используется для хранения базового URL CDN, который будет использоваться для добавления к нему путей к изображениям карточек.

constructor(cdn: string, baseUrl: string, options?: RequestInit):
cdn: string: Этот параметр представляет URL для Content Delivery Network (CDN). Он используется для определения базового URL, который будет использоваться для формирования полных URL изображений карточек.
baseUrl: string: Этот параметр представляет базовый URL для API. Он используется для формирования URL для каждого запроса к API.
options?: RequestInit: Этот параметр является необязательным и представляет объект опций запроса для использования при выполнении HTTP-запросов к API. Объект RequestInit используется в стандартном API Fetch для определения различных параметров запроса, таких как метод, заголовки, тело запроса и другие.

Методы:
getCardList:() Promise<IProduct>: Запрашивает список лотов с сервера и обрабатывает каждый лот, добавляя URL к изображению лота.
orderProducts:(order: IOrder): Promise<IOrderResult>: Отправляет запрос на сервер с информацией о заказе и возвращает результат заказа.

### Класс Order 

Этот класс представляет форму для размещения заказа (Order).

Конструктор:
Принимает два параметра: container (контейнер формы) и events (события формы).
Вызывает конструктор родительского класса Form, передавая ему переданные параметры.
Сеттеры phone и email:
Эти сеттеры используются для установки значений полей "телефон" и "электронная почта" в форме.
Они получают строковое значение value, представляющее телефонный номер или адрес электронной почты.
Затем они находят соответствующие элементы формы по их именам (предположительно, "phone" и "email") с помощью метода namedItem контейнера формы.
После этого они устанавливают значение элементов формы в полученное значение value.
В итоге, этот класс позволяет устанавливать значения для полей "телефон" и "электронная почта" в форме заказа, что может быть полезно при заполнении формы данными извне или программным образом.

### Класс Page

Этот класс Page представляет страницу веб-приложения и наследует функциональность от базового класса Component<IPage>. 

Конструктор:
Принимает два параметра:
container: корневой элемент (HTMLElement), в который будет встроена страница.
events: объект событий (IEvents), используемый для управления событиями на странице.
Вызывает конструктор родительского класса Component<IPage> с переданным корневым элементом.
Использует функцию ensureElement для получения ссылок на различные элементы страницы по их селекторам.
Добавляет обработчик события клика на элемент корзины (_basket), который вызывает событие 'bids:open'.

Сеттеры:
counter: Устанавливает текстовое содержимое элемента _counter в соответствии с переданным значением.
catalog: Заменяет текущие дочерние элементы _catalog на переданные элементы товаров.
locked: Добавляет или удаляет класс 'page__wrapper_locked' у элемента _wrapper в зависимости от переданного значения. Этот класс используется для блокировки страницы.
Этот класс Page предоставляет методы для управления различными элементами страницы, такими как счетчик, каталог товаров и блокировка страницы. Он использует наследование от базового класса Component<IPage>, чтобы переиспользовать общие методы для работы с DOM и добавляет специфичную для страницы логику.

### Класс Basket

Этот класс Basket представляет корзину товаров и наследует функциональность от базового класса Component<IBasketView>.

Конструктор:
Принимает два параметра:

container: корневой элемент (HTMLElement), в который будет встроена корзина.
events: объект событий (EventEmitter), используемый для управления событиями в корзине.
Конструктор выполняет следующие действия:

Вызывает конструктор родительского класса Component<IBasketView> с переданным корневым элементом.
Использует функцию ensureElement для получения ссылки на элемент списка корзины (_list).
Находит элементы общей стоимости (_total), кнопки подтверждения (_button) и удаления товара (_delete) с помощью querySelector.
Добавляет обработчик события клика на кнопку подтверждения, который вызывает событие 'order'.
Инициализирует массив товаров (items) как пустой.

Сеттеры:
items: Принимает массив элементов товаров (HTMLElement[]). Если массив не пуст, заменяет текущие дочерние элементы списка корзины на переданные элементы и активирует кнопку подтверждения. Если массив пуст, отображает сообщение "Корзина пуста" и деактивирует кнопку подтверждения.
total: Устанавливает текстовое содержимое элемента общей стоимости (_total) в соответствии с переданным значением, форматируя его с помощью функции formatNumber и добавляя единицу измерения "синапсов".
Этот класс Basket предоставляет методы для управления элементами корзины, такими как добавление или удаление товаров и обновление общей стоимости. Он использует наследование от базового класса Component<IBasketView> для переиспользования общих методов для работы с DOM и добавляет специфичную для корзины логику.

### Класс Success

Этот класс Success представляет компонент успешного завершения заказа и наследует функциональность от базового класса Component<ISuccess>.

Конструктор:
Принимает два параметра:

container: корневой элемент (HTMLElement), в который будет встроен компонент успешного завершения заказа.
actions: объект действий (ISuccessActions), содержащий обработчики событий для данного компонента.
Конструктор выполняет следующие действия:

Вызывает конструктор родительского класса Component<ISuccess> с переданным корневым элементом.
Использует функцию ensureElement для получения ссылок на кнопку закрытия (_submit) и элемент отображения общей суммы (_total).
Если в объекте действий (actions) передан обработчик события нажатия кнопки (onClick), добавляет обработчик события клика на кнопку закрытия, который вызывает переданный обработчик.

Сеттеры:
total: Устанавливает текстовое содержимое элемента отображения общей суммы (_total) в соответствии с переданным значением, форматируя его в строку "Списано {value} синапсов".
Этот класс Success предоставляет методы для управления элементами компонента успешного завершения заказа, такими как обновление общей суммы и обработка нажатия кнопки закрытия. Он использует наследование от базового класса Component<ISuccess> для переиспользования общих методов для работы с DOM и добавляет специфичную для компонента логику.



## Ключевые типы данных

Тип Category
Перечисление возможных категорий продуктов:

'софт-скил'
'хард-скил'
'дополнительное'
'кнопка'
'другое'


Интерфейс IProduct
Описание продукта:

id: идентификатор продукта (строка).
description?: описание продукта (опциональная строка).
image: URL изображения продукта (строка).
tittle: название продукта (строка).
category: категория продукта (типа Category).
price: цена продукта (число или строка).
Интерфейс IBasket
Описание корзины:

items: список продуктов в корзине (массив IProduct).
counter: количество товаров в корзине (число).


Интерфейс IOrderForm
Описание формы заказа:

email: электронная почта покупателя (строка).
phone: телефон покупателя (строка).
payment: способ оплаты (строка).
address: адрес доставки (строка).
total: общая сумма заказа (число или строка).


Интерфейс IOrder
Описание заказа, расширяет IOrderForm:

items: список идентификаторов продуктов в заказе (массив строк).
Интерфейс IAppState
Описание состояния приложения:

catalog: каталог продуктов (массив IProduct).
basket: идентификаторы продуктов в корзине (массив строк).
order: текущий заказ (IOrder или null).
loading: индикатор загрузки (логическое значение).


Интерфейс IOrderResult
Результат заказа:

id: идентификатор заказа (строка).
Интерфейс ILarekAPI
API для взаимодействия с сервером:

getCardList: метод для получения списка продуктов, возвращает промис с массивом IProduct.
orderProducts: метод для оформления заказа, принимает объект типа IOrder, возвращает промис с результатом типа IOrderResult.


Интерфейс IPage
Описание состояния страницы:

counter: счетчик элементов (число).
catalog: массив элементов каталога (массив HTMLElement).
locked: индикатор блокировки страницы (логическое значение).
Тип FormErrors
Ошибки формы:

Опциональные поля, ключи которых соответствуют полям IOrder, а значения - строки с сообщениями об ошибках.